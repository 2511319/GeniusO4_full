#!/bin/bash
# ðŸ”’ ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð·Ð°Ñ‰Ð¸Ñ‚Ð½Ñ‹Ñ… Git hooks Ð´Ð»Ñ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾Ð¹ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸

echo "ðŸ”’ ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð·Ð°Ñ‰Ð¸Ñ‚Ð½Ñ‹Ñ… Ð¼ÐµÑ…Ð°Ð½Ð¸Ð·Ð¼Ð¾Ð² Git..."

# Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸ÑŽ Ð´Ð»Ñ hooks ÐµÑÐ»Ð¸ ÐµÑ‘ Ð½ÐµÑ‚
mkdir -p ../.git/hooks

# Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ pre-push hook Ð´Ð»Ñ Ð·Ð°Ñ‰Ð¸Ñ‚Ñ‹ Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½Ð°
cat > ../.git/hooks/pre-push << 'EOF'
#!/bin/bash
# ðŸ”’ Ð—ÐÐ©Ð˜Ð¢Ð ÐŸÐ ÐžÐ”ÐÐšÐ¨Ð•ÐÐ - Ð—Ð°Ð¿Ñ€ÐµÑ‚ Ð¿ÑƒÑˆÐ° Ð² Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½-Ð²ÐµÑ‚ÐºÑƒ

current_branch=$(git branch --show-current)

if [[ "$current_branch" == "ChartGenius-prod-try" ]]; then
    echo "âŒ Ð—ÐÐŸÐ Ð•Ð©Ð•ÐÐž: ÐŸÑƒÑˆ Ð² Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½-Ð²ÐµÑ‚ÐºÑƒ Ð·Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ð½!"
    echo "ðŸš€ Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð²ÐµÑ‚ÐºÑƒ 'development' Ð´Ð»Ñ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸"
    echo "ðŸ“‹ Ð¢ÐµÐºÑƒÑ‰Ð°Ñ Ð²ÐµÑ‚ÐºÐ°: $current_branch"
    echo ""
    echo "Ð”Ð»Ñ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ð½Ð° Ð²ÐµÑ‚ÐºÑƒ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸:"
    echo "git checkout development"
    exit 1
fi

if [[ "$current_branch" == "master1" ]]; then
    echo "âŒ Ð—ÐÐŸÐ Ð•Ð©Ð•ÐÐž: ÐŸÑƒÑˆ Ð² Ð¾ÑÐ½Ð¾Ð²Ð½ÑƒÑŽ Ð²ÐµÑ‚ÐºÑƒ Ð·Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ð½!"
    echo "ðŸš€ Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð²ÐµÑ‚ÐºÑƒ 'development' Ð´Ð»Ñ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸"
    exit 1
fi

echo "âœ… ÐŸÑƒÑˆ Ñ€Ð°Ð·Ñ€ÐµÑˆÐµÐ½ Ð´Ð»Ñ Ð²ÐµÑ‚ÐºÐ¸: $current_branch"
EOF

# Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ pre-commit hook Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹
cat > ../.git/hooks/pre-commit << 'EOF'
#!/bin/bash
# ðŸ”’ Ð—ÐÐ©Ð˜Ð¢Ð ÐŸÐ ÐžÐ”ÐÐšÐ¨Ð•ÐÐ - ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ð½Ðµ Ð¸Ð·Ð¼ÐµÐ½ÑÑŽÑ‚ÑÑ Ð»Ð¸ Ñ„Ð°Ð¹Ð»Ñ‹ Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½Ð°
if git diff --cached --name-only | grep -q "^production/"; then
    echo "âŒ Ð—ÐÐŸÐ Ð•Ð©Ð•ÐÐž: ÐžÐ±Ð½Ð°Ñ€ÑƒÐ¶ÐµÐ½Ñ‹ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð² Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¸ production/"
    echo "ðŸ”’ ÐŸÑ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½-Ð²ÐµÑ€ÑÐ¸Ñ Ð´Ð¾Ð»Ð¶Ð½Ð° Ð¾ÑÑ‚Ð°Ð²Ð°Ñ‚ÑŒÑÑ Ð½ÐµÑ‚Ñ€Ð¾Ð½ÑƒÑ‚Ð¾Ð¹!"
    echo ""
    echo "Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹ Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½Ð°:"
    git diff --cached --name-only | grep "^production/" | sed 's/^/  - /'
    echo ""
    echo "ÐžÑ‚Ð¼ÐµÐ½Ð¸Ñ‚Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¾Ð¹:"
    echo "git reset HEAD production/"
    exit 1
fi

echo "âœ… ÐšÐ¾Ð¼Ð¼Ð¸Ñ‚ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐµÐ½ - Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð² development/"
EOF

# Ð”ÐµÐ»Ð°ÐµÐ¼ hooks Ð¸ÑÐ¿Ð¾Ð»Ð½ÑÐµÐ¼Ñ‹Ð¼Ð¸
chmod +x ../.git/hooks/pre-push
chmod +x ../.git/hooks/pre-commit

echo "âœ… Ð—Ð°Ñ‰Ð¸Ñ‚Ð½Ñ‹Ðµ Ð¼ÐµÑ…Ð°Ð½Ð¸Ð·Ð¼Ñ‹ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ñ‹!"
echo ""
echo "ðŸ”’ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ‹Ðµ Ð·Ð°Ñ‰Ð¸Ñ‚Ñ‹:"
echo "  - Ð—Ð°Ð¿Ñ€ÐµÑ‚ Ð¿ÑƒÑˆÐ° Ð² Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½-Ð²ÐµÑ‚ÐºÐ¸"
echo "  - Ð—Ð°Ð¿Ñ€ÐµÑ‚ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ñ„Ð°Ð¹Ð»Ð¾Ð² production/"
echo "  - ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ñ€Ð¸ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ð°Ñ…"
echo ""
echo "ðŸš€ Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ð¼Ð¾Ð¶Ð½Ð¾ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°Ñ‚ÑŒ Ð² development/"
