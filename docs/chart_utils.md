# Утилиты графика

Файл `frontend/src/chartUtils.js` содержит набор функций для подготовки свечных данных.
Эти функции используются компонентом `TradingViewChart` и могут быть полезны
при построении различных типов графиков.

## computeHeikinAshi(raw)
Преобразует обычные OHLC-свечи в формат Heikin Ashi. Возвращает новый массив
свойств `open`, `high`, `low`, `close` и `time`. Позволяет построить
сглаженный график.

## computeRenko(raw, brick = 0.5)
Создаёт массив ренко-блоков размером `brick` из входных свечей. Новый блок
появляется, когда цена проходит расстояние в `brick`. Поля результата аналогичны
стандартным OHLC.

## findSRLevels(data, depth = 14)
Ищет уровни поддержки и сопротивления в наборе свечей. Параметр `depth` задаёт
ширину области поиска локальных экстремумов. Возвращает список объектов с
полями `price`, `type` (`support` или `resistance`) и `time`.

### Использование в проекте
В компоненте `TradingViewChart.jsx` пользователь может переключать тип
отображения свечей (обычные, Heikin Ashi, Renko) и включать уровни S/R.
При изменении параметров соответствующие функции из `chartUtils.js`
применяются к данным графика.

### Legend: управление видимостью слоёв

В левом нижнем углу графика отображается небольшая легенда. Каждый пункт
соответствует отдельной серии: индикатору, прогнозу либо вспомогательным
уровням. Нажатие на название в легенде включает или выключает видимость
соответствующей серии. Активные элементы показаны ярко, выключенные
полупрозрачны.

### Виртуальные свечи и настройки тултипов

Раздел `price_prediction` может содержать «виртуальные» свечи. Они обрабатываются
функцией `parseVirtualCandles()` и добавляются как отдельный candlestickSeries.
В легенде такая серия отображается как «Прогноз» и управляется так же, как и
остальные слои.

При наведении курсора отображается кастомный тултип. Он выводит значения OHLC
текущей свечи и при наличии текста прогноза добавляет его под основными данными.
Логика показа тултипа задаётся в `TradingViewChart.jsx` через список
`allowedLayers` – тултип виден только для указанных серий.

